<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/neon-animated/neon-animated-pages.html">
<link rel="import" href="../../bower_components/neon-animated/animations/slide-from-right-animation.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<dom-module id="tab-pages">
  <template>
    <link rel="stylesheet" href="tab-pages.css">
    <section>
      <div class="hidden">
        <content id="tabHeader" select=".tabHeader"></content>
        <content id="tabContent" select=".tabContent"></content>
        <paper-tabs id="mainTab" selected="{{selectedTab}}" noink>
        </paper-tabs>
      </div>
      <neon-animated-pages id="mainPage" selected="{{selectedTab}}" transition="slide-from-right">
      </neon-animated-pages>
    </section>
  </template>
  <script>
    Polymer({
        
		is: "tab-pages",
		
		properties: {
			selectedTab: {
				type: Number,
				value: 0
			},
			
			pages: null,
			tabs: null
		},
        
 		getCollapse: function() {
			if(this.pages[this.selectedTab]) {
				if(this.pages[this.selectedTab].getCollapse && this.pages[this.selectedTab].getCollapse()) {
					return this.pages[this.selectedTab].getCollapse();
				} else if(this.pages[this.selectedTab].getExpandedHeader) {
					return this.pages[this.selectedTab].getExpandedHeader();
				}
			}
			return null;
		},
		
		getExpandedHeader: function() {
			return this.$.mainTab;
		},
		
		attached: function() {
			this.async(function() {
				// populate tabs and animated pages
				
				this.pages = Polymer.dom(this.$.tabContent).getDistributedNodes();
				this.tabs = Polymer.dom(this.$.tabHeader).getDistributedNodes();
				
				while(this.$.mainTab.firstChild) {
					this.$.mainTab.removeChild(this.$.mainTab.firstChild);
				}
				
				if(this.tabs.length <= 0) {
					this.tabs = [];
					for(var i = 0; i < this.pages.length; i++) {
						if(this.pages[i].getTabHeader) {
							this.tabs.push(this.pages[i].getTabHeader());
						} else if(this.pages[i].getExpandedHeader) {
							this.tabs.push(this.pages[i].getExpandedHeader());
						}
					}
				}
				
				for(var i = 0; i < this.tabs.length; i++) {
					var newTab = document.createElement('paper-tab');
					newTab.appendChild(this.tabs[i]);
					this.$.mainTab.appendChild(newTab);
				}
				
				for(var i = 0; i < this.pages.length; i++) {
					var divPage = document.createElement('div');
					divPage.setAttribute('slide-from-right', 'true');
					divPage.appendChild(this.pages[i]);
					this.$.mainPage.appendChild(divPage);
				}
			});
		},
		
        ready: function() {
        }
        
    });
  </script>
</dom-module>
